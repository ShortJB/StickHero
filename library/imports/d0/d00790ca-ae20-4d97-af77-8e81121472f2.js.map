{"version":3,"sources":["assets\\StickHero\\Scripts\\landMaker.js"],"names":["spriteCreator","require","perfectLabel","storageManager","gameDirector","window","fn","fsm","cc","Class","Component","properties","landRange","v2","landWidth","hero","Node","firstLand","secondLand","moveDuration","stickSpeed","heroMoveSpeed","stickWidth","canvas","scoreLabel","Label","hightestScoreLabel","overLabel","onLoad","StateMachine","data","init","transitions","name","from","to","methods","onLeaveHeroTicked","unregisterEvent","onStickLengthen","stickLengthen","stick","createStick","x","width","anchorX","ani","getComponent","Animation","play","onHeroTick","onStickFall","stickFall","rotateBy","easing","easeIn","callFunc","stickLength","height","currentLandRange","heroMoveToStickEnd","heroMoveToLand","perfect","getScore","pl","showPerfect","se","sequence","runAction","onHeroMoveToLand","stop","landMove","heroMove","length","onLandMove","registerEvent","landCreateAndMove","onHeroMoveToStickEnd","heroDown","onHeroDown","gameOver","stickAndHeroDownAction","onGameOver","node","active","onRestart","director","loadScene","runLength","score","heroWorldPosX","changeHightestScoreLabel","createNewLand","range","getLandRange","setPosition","on","onStop","event","state","_name","EventType","TOUCH_START","touchStart","bind","TOUCH_END","touchEnd","TOUCH_CANCEL","touchCancel","console","log","targetOff","update","dt","heroTick","stickAction","heroAction","moveBy","seq","target","time","winSize","getWinSize","action","l","secondAction","parent","getLandWidth","num","getHighestScore","setHighestScore","string","y","Math","random","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var spriteCreator = require(\"spriteCreator\");\r\nvar perfectLabel = require(\"perfectLabel\");\r\nvar storageManager = require(\"storageManager\");\r\nvar gameDirector = null;\r\nwindow.fn = {};\r\nvar fsm;\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        landRange: cc.v2(20, 300),\r\n        landWidth: cc.v2(20, 200),\r\n        hero: cc.Node,\r\n        firstLand: cc.Node,\r\n        secondLand: cc.Node,\r\n        moveDuration: 0.5,\r\n        stickSpeed: 400,\r\n        heroMoveSpeed: 400,\r\n        // stick:cc.Node,\r\n        // stickLengthen:false,\r\n        stickWidth: 6,\r\n        canvas: cc.Node,\r\n        scoreLabel: cc.Label,\r\n        hightestScoreLabel: cc.Label,\r\n        overLabel: cc.Label,\r\n        perfectLabel: cc.Node\r\n    },\r\n    onLoad: function () {\r\n        fn.fsm = new StateMachine({\r\n            data: {\r\n                gameDirector: null,\r\n            },\r\n            init: 'stand',\r\n            transitions: [\r\n                { name: 'stickLengthen', from: 'stand', to: 'stickLengthened' },\r\n                { name: 'heroTick', from: 'stickLengthened', to: 'heroTicked' },\r\n                { name: 'stickFall', from: 'heroTicked', to: 'stickFalled' },\r\n                { name: 'heroMoveToLand', from: 'stickFalled', to: 'heroMovedToLand' },\r\n                { name: 'landMove', from: 'heroMovedToLand', to: 'stand' },\r\n                { name: 'heroMoveToStickEnd', from: 'stickFalled', to: 'heroMovedToStickEnd' },\r\n                { name: 'heroDown', from: 'heroMovedToStickEnd', to: 'heroDowned' },\r\n                { name: 'gameOver', from: 'heroDowned', to: 'end' },\r\n                { name: 'restart', from: 'end', to: 'stand' },\r\n            ],\r\n            methods: {\r\n                onLeaveHeroTicked() {\r\n                    gameDirector.unregisterEvent();\r\n                },\r\n                onStickLengthen() {\r\n                    gameDirector.stickLengthen = true;\r\n                    gameDirector.stick = gameDirector.createStick();\r\n                    gameDirector.stick.x = gameDirector.hero.x + gameDirector.hero.width * (1 - gameDirector.hero.anchorX) + gameDirector.stick.width * gameDirector.stick.anchorX;\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    ani.play('heroPush');\r\n                },\r\n                onHeroTick() {\r\n                    gameDirector.stickLengthen = false;\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    ani.play('heroTick');\r\n                },\r\n                onStickFall() {\r\n                    //stick fall action.\r\n                    var stickFall = cc.rotateBy(0.5, 90);\r\n                    stickFall.easing(cc.easeIn(3));\r\n                    var callFunc = cc.callFunc(function () {\r\n                        var stickLength = gameDirector.stick.height - gameDirector.stick.width * gameDirector.stick.anchorX;\r\n                        if (stickLength < gameDirector.currentLandRange || stickLength > gameDirector.currentLandRange + gameDirector.secondLand.width) {//failed.\r\n                            fsm.heroMoveToStickEnd();\r\n                        } else {//successed\r\n                            fsm.heroMoveToLand();\r\n                            if (stickLength > gameDirector.currentLandRange + gameDirector.secondLand.width / 2 - 5\r\n                                && stickLength < gameDirector.currentLandRange + gameDirector.secondLand.width / 2 + 5) {\r\n                                gameDirector.perfect++;\r\n                                gameDirector.getScore(gameDirector.perfect);\r\n                                var pl = gameDirector.perfectLabel.getComponent(perfectLabel);\r\n                                pl.showPerfect(gameDirector.perfect);\r\n                            } else {\r\n                                gameDirector.perfect = 0;\r\n                            }\r\n                        }\r\n                    });\r\n                    var se = cc.sequence(stickFall, callFunc);\r\n                    gameDirector.stick.runAction(se);\r\n                },\r\n                onHeroMoveToLand() {\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    var callFunc = cc.callFunc(function () {\r\n                        ani.stop('heroRun');\r\n                        gameDirector.getScore();\r\n                        fsm.landMove();\r\n                    });\r\n                    ani.play('heroRun');\r\n                    gameDirector.heroMove(gameDirector.hero, { length: gameDirector.currentLandRange + gameDirector.secondLand.width, callFunc: callFunc });\r\n                },\r\n                onLandMove() {\r\n                    var callFunc = cc.callFunc(function () {\r\n                        gameDirector.registerEvent();\r\n                    });\r\n                    gameDirector.landCreateAndMove(callFunc);\r\n                },\r\n                onHeroMoveToStickEnd() {\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    var callFunc = cc.callFunc(function () {\r\n                        ani.stop('heroRun');\r\n                        fsm.heroDown();\r\n                    });\r\n                    ani.play('heroRun');\r\n                    gameDirector.heroMove(gameDirector.hero, { length: gameDirector.stick.height, callFunc: callFunc });\r\n                },\r\n                onHeroDown() {\r\n                    var callFunc = cc.callFunc(function () {\r\n                        fsm.gameOver();\r\n                    });\r\n                    gameDirector.stickAndHeroDownAction(callFunc);\r\n                },\r\n                onGameOver() {\r\n                    gameDirector.overLabel.node.active = true;\r\n                },\r\n                onRestart() {\r\n                    cc.director.loadScene(\"MainGameScene\");\r\n                }\r\n            }\r\n        });\r\n\r\n        fsm = fn.fsm;\r\n        //init data\r\n        // alert(storageManager.getHighestScore());\r\n        gameDirector = this;\r\n        this.runLength = 0,\r\n            this.stick = null;\r\n        this.stickLengthen = false;\r\n        this.score = 0;\r\n        this.perfect = 0;\r\n        this.currentLandRange = 0;\r\n        this.heroWorldPosX = 0;\r\n        this.changeHightestScoreLabel();\r\n\r\n        //create new land;\r\n        this.createNewLand();\r\n        var range = this.getLandRange();\r\n        this.heroWorldPosX = this.firstLand.width - (1 - this.hero.anchorX) * this.hero.width - this.stickWidth;\r\n        this.secondLand.setPosition(range + this.firstLand.width, 0);\r\n\r\n        this.registerEvent();\r\n        //init hero animation callback.\r\n        var ani = gameDirector.hero.getComponent(cc.Animation);\r\n        //ani.on('stop',(event)=>{\r\n        //if(event.target.name =='heroTick'){\r\n        //fsm.stickFall();\r\n        //}\r\n        //});\r\n        ani.on('stop', this.onStop, this);\r\n    },\r\n\r\n    onStop:function (event, state) {\r\n        if(state &&state._name && state._name === 'heroTick'){\r\n            fsm.stickFall();\r\n        }\r\n    },\r\n\r\n    registerEvent() {\r\n        this.canvas.on(cc.Node.EventType.TOUCH_START, this.touchStart.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_END, this.touchEnd.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_CANCEL, this.touchCancel.bind(this), this.node);\r\n        console.log(\"on\");\r\n    },\r\n\r\n    unregisterEvent() {\r\n        this.canvas.targetOff(this.node);\r\n        console.log(\"off\");\r\n    },\r\n    update(dt) {\r\n        // console.log(dt);\r\n        if (this.stickLengthen) {\r\n            this.stick.height += dt * this.stickSpeed;\r\n            // this.stick.height = this.currentLandRange + this.secondLand.width/2;\r\n        }\r\n    },\r\n    touchStart(event) {\r\n        fsm.stickLengthen();\r\n        cc.log(\"touchStart\");\r\n    },\r\n    touchEnd(event) {\r\n        fsm.heroTick();\r\n        cc.log(\"touchEnd\");\r\n    },\r\n    touchCancel() {\r\n        this.touchEnd();\r\n        cc.log(\"touchCancel\");\r\n    },\r\n    stickAndHeroDownAction(callFunc) {\r\n        //stick down action;\r\n        var stickAction = cc.rotateBy(0.5, 90);\r\n        stickAction.easing(cc.easeIn(3));\r\n        this.stick.runAction(stickAction);\r\n        //hero down action;\r\n        var heroAction = cc.moveBy(0.5, cc.v2(0, -300 - this.hero.height));\r\n        heroAction.easing(cc.easeIn(3));\r\n        var seq = cc.sequence(heroAction, callFunc);\r\n        this.hero.runAction(seq);\r\n    },\r\n    heroMove(target, data) {\r\n        var time = data.length / this.heroMoveSpeed;\r\n        var heroMove = cc.moveBy(time, cc.v2(data.length, 0));\r\n        if (data.callFunc) {\r\n            var se = cc.sequence(heroMove, data.callFunc);\r\n            this.hero.runAction(se);\r\n        } else {\r\n            this.hero.runAction(heroMove);\r\n        }\r\n    },\r\n    landCreateAndMove(callFunc) {\r\n        var winSize = cc.director.getWinSize();\r\n        //firstland;\r\n        var length = this.currentLandRange + this.secondLand.width;\r\n        this.runLength += length;\r\n        var action = cc.moveBy(this.moveDuration, cc.v2(-length, 0));\r\n        this.node.runAction(action);\r\n        this.firstLand = this.secondLand;\r\n\r\n        this.createNewLand();\r\n\r\n        //landRange\r\n        var range = this.getLandRange();\r\n\r\n        //secondland;\r\n        this.secondLand.setPosition(this.runLength + winSize.width, 0);\r\n        var l = winSize.width - range - this.heroWorldPosX - this.hero.width * this.hero.anchorX - this.stickWidth;\r\n        var secondAction = cc.moveBy(this.moveDuration, cc.v2(-l, 0));\r\n        var seq = cc.sequence(secondAction, callFunc);\r\n        this.secondLand.runAction(seq);\r\n    },\r\n    createStick() {\r\n        cc.log(\"sc\");\r\n        var stick = spriteCreator.createStick(this.stickWidth);\r\n        stick.parent = this.node;\r\n        return stick\r\n    },\r\n    createNewLand() {\r\n        this.secondLand = spriteCreator.createNewLand(this.getLandWidth());\r\n        this.secondLand.parent = this.node;\r\n    },\r\n    getScore(num) {\r\n        if (num) {\r\n            this.score += num;\r\n        } else {\r\n            this.score++;\r\n        }\r\n        if (storageManager.getHighestScore() < this.score) {\r\n            storageManager.setHighestScore(this.score);\r\n            this.changeHightestScoreLabel();\r\n        }\r\n        this.scoreLabel.string = \"得分:\" + this.score;\r\n    },\r\n    changeHightestScoreLabel() {\r\n        this.hightestScoreLabel.string = \"最高分:\" + storageManager.getHighestScore();\r\n    },\r\n    getLandRange() {\r\n        this.currentLandRange = this.landRange.x + (this.landRange.y - this.landRange.x) * Math.random();\r\n        var winSize = cc.director.getWinSize();\r\n        if (winSize.width < this.currentLandRange + this.heroWorldPosX + this.hero.width + this.secondLand.width) {\r\n            this.currentLandRange = winSize.width - this.heroWorldPosX - this.hero.width - this.secondLand.width;\r\n        }\r\n        return this.currentLandRange;\r\n    },\r\n    getLandWidth() {\r\n        return this.landWidth.x + (this.landWidth.y - this.landWidth.x) * Math.random();\r\n    }\r\n});\r\nmodule.exports = fsm;"]}