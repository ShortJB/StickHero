{"version":3,"sources":["assets\\StickHero\\Scripts\\landMaker.js"],"names":["spriteCreator","require","perfectLabel","storageManager","fsm","gameDirector","cc","Class","Component","properties","landRange","v2","landWidth","hero","Node","firstLand","secondLand","moveDuration","stickSpeed","heroMoveSpeed","stickWidth","canvas","scoreLabel","Label","hightestScoreLabel","overLabel","onLoad","StateMachine","data","init","transitions","name","from","to","methods","onLeaveHeroTicked","unregisterEvent","onStickLengthen","stickLengthen","stick","createStick","x","width","anchorX","ani","getComponent","Animation","play","onHeroTick","onStickFall","stickFall","rotateBy","easing","easeIn","callFunc","stickLength","height","currentLandRange","heroMoveToStickEnd","heroMoveToLand","perfect","getScore","pl","showPerfect","se","sequence","runAction","onHeroMoveToLand","stop","landMove","heroMove","length","onLandMove","registerEvent","landCreateAndMove","onHeroMoveToStickEnd","heroDown","onHeroDown","gameOver","stickAndHeroDownAction","onGameOver","node","active","onRestart","director","loadScene","runLength","score","heroWorldPosX","changeHightestScoreLabel","createNewLand","range","getLandRange","setPosition","on","event","target","EventType","TOUCH_START","touchStart","bind","TOUCH_END","touchEnd","TOUCH_CANCEL","touchCancel","console","log","targetOff","update","dt","heroTick","stickAction","heroAction","moveBy","p","seq","time","winSize","getWinSize","action","l","secondAction","parent","getLandWidth","num","getHighestScore","setHighestScore","string","y","Math","random","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var spriteCreator = require(\"spriteCreator\");\r\nvar perfectLabel = require(\"perfectLabel\");\r\nvar storageManager = require(\"storageManager\");\r\nvar fsm;\r\nvar gameDirector = null;\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        landRange:cc.v2(20,300),\r\n        landWidth:cc.v2(20,200),\r\n        hero:cc.Node,\r\n        firstLand:cc.Node,\r\n        secondLand:cc.Node,\r\n        moveDuration:0.5,\r\n        stickSpeed:400,\r\n        heroMoveSpeed:400,\r\n        // stick:cc.Node,\r\n        // stickLengthen:false,\r\n        stickWidth:6,\r\n        canvas:cc.Node,\r\n        scoreLabel:cc.Label,\r\n        hightestScoreLabel:cc.Label,\r\n        overLabel:cc.Label,\r\n        perfectLabel:cc.Node\r\n    },\r\n    onLoad: function () {\r\n        fsm = new StateMachine({\r\n            data:{\r\n                gameDirector:null,\r\n            },\r\n            init: 'stand',\r\n            transitions:[\r\n                {name:'stickLengthen',from:'stand',to:'stickLengthened'},\r\n                {name:'heroTick',from:'stickLengthened',to:'heroTicked'},\r\n                {name:'stickFall',from:'heroTicked',to:'stickFalled'},\r\n                {name:'heroMoveToLand',from:'stickFalled',to:'heroMovedToLand'},\r\n                {name:'landMove',from:'heroMovedToLand',to:'stand'},\r\n                {name:'heroMoveToStickEnd',from:'stickFalled',to:'heroMovedToStickEnd'},\r\n                {name:'heroDown',from:'heroMovedToStickEnd',to:'heroDowned'},\r\n                {name:'gameOver',from:'heroDowned',to:'end'},\r\n                {name:'restart',from:'end',to:'stand'},\r\n            ],\r\n            methods:{\r\n                onLeaveHeroTicked(){\r\n                    gameDirector.unregisterEvent();\r\n                },\r\n                onStickLengthen(){\r\n                    gameDirector.stickLengthen = true;\r\n                    gameDirector.stick = gameDirector.createStick();\r\n                    gameDirector.stick.x = gameDirector.hero.x + gameDirector.hero.width * (1-gameDirector.hero.anchorX) + gameDirector.stick.width * gameDirector.stick.anchorX;\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    ani.play('heroPush');\r\n                },\r\n                onHeroTick(){\r\n                    gameDirector.stickLengthen = false;\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    ani.play('heroTick');\r\n                },\r\n                onStickFall(){\r\n                    //stick fall action.\r\n                    var stickFall = cc.rotateBy(0.5, 90);\r\n                    stickFall.easing(cc.easeIn(3));\r\n                    var callFunc = cc.callFunc(function(){\r\n                        var stickLength = gameDirector.stick.height-gameDirector.stick.width * gameDirector.stick.anchorX;\r\n                        if(stickLength < gameDirector.currentLandRange || stickLength > gameDirector.currentLandRange+gameDirector.secondLand.width){//failed.\r\n                            fsm.heroMoveToStickEnd();\r\n                        }else{//successed\r\n                            fsm.heroMoveToLand();\r\n                            if(stickLength > gameDirector.currentLandRange + gameDirector.secondLand.width/2-5 \r\n                                &&stickLength < gameDirector.currentLandRange + gameDirector.secondLand.width/2+5){\r\n                                gameDirector.perfect ++;\r\n                                gameDirector.getScore(gameDirector.perfect);\r\n                                var pl = gameDirector.perfectLabel.getComponent(perfectLabel);\r\n                                pl.showPerfect(gameDirector.perfect);\r\n                            }else{\r\n                                gameDirector.perfect = 0;\r\n                            }\r\n                        }\r\n                    });\r\n                    var se =cc.sequence(stickFall,callFunc);\r\n                    gameDirector.stick.runAction(se);\r\n                },\r\n                onHeroMoveToLand(){\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    var callFunc = cc.callFunc(function(){\r\n                        ani.stop('heroRun');\r\n                        gameDirector.getScore();\r\n                        fsm.landMove();\r\n                    });\r\n                    ani.play('heroRun');\r\n                    gameDirector.heroMove(gameDirector.hero,{length:gameDirector.currentLandRange+gameDirector.secondLand.width,callFunc:callFunc});\r\n                },\r\n                onLandMove(){\r\n                    var callFunc = cc.callFunc(function(){\r\n                        gameDirector.registerEvent();\r\n                    });\r\n                    gameDirector.landCreateAndMove(callFunc);\r\n                },\r\n                onHeroMoveToStickEnd(){\r\n                    var ani = gameDirector.hero.getComponent(cc.Animation);\r\n                    var callFunc = cc.callFunc(function(){\r\n                        ani.stop('heroRun');\r\n                        fsm.heroDown();\r\n                    });\r\n                    ani.play('heroRun');\r\n                    gameDirector.heroMove(gameDirector.hero,{length:gameDirector.stick.height,callFunc:callFunc});\r\n                },\r\n                onHeroDown(){\r\n                     var callFunc = cc.callFunc(function(){\r\n                        fsm.gameOver();\r\n                    });\r\n                    gameDirector.stickAndHeroDownAction(callFunc);\r\n                },\r\n                onGameOver(){\r\n                    gameDirector.overLabel.node.active = true;\r\n                },\r\n                onRestart(){\r\n                    cc.director.loadScene(\"MainGameScene\");\r\n                }\r\n            }\r\n        });\r\n        //init data\r\n        // alert(storageManager.getHighestScore());\r\n        gameDirector = this;\r\n        this.runLength = 0,\r\n        this.stick = null;\r\n        this.stickLengthen = false;\r\n        this.score = 0;\r\n        this.perfect = 0;\r\n        this.currentLandRange = 0;\r\n        this.heroWorldPosX = 0;\r\n        this.changeHightestScoreLabel();\r\n\r\n        //create new land;\r\n        this.createNewLand();\r\n        var range = this.getLandRange();\r\n        this.heroWorldPosX = this.firstLand.width - (1-this.hero.anchorX) * this.hero.width - this.stickWidth;\r\n        this.secondLand.setPosition(range+this.firstLand.width,0);\r\n        \r\n        this.registerEvent();\r\n        //init hero animation callback.\r\n        var ani = gameDirector.hero.getComponent(cc.Animation);\r\n        ani.on('stop',(event)=>{\r\n            if(event.target.name =='heroTick'){\r\n                fsm.stickFall();\r\n            }\r\n        });\r\n    },\r\n    registerEvent(){\r\n        this.canvas.on(cc.Node.EventType.TOUCH_START, this.touchStart.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_END,this.touchEnd.bind(this), this.node);\r\n        this.canvas.on(cc.Node.EventType.TOUCH_CANCEL,this.touchCancel.bind(this), this.node);\r\n        console.log(\"on\");\r\n    },\r\n    unregisterEvent(){\r\n        this.canvas.targetOff(this.node);\r\n        console.log(\"off\");\r\n    },\r\n    update(dt){\r\n        // console.log(dt);\r\n        if(this.stickLengthen){\r\n            this.stick.height += dt*this.stickSpeed;\r\n            // this.stick.height = this.currentLandRange + this.secondLand.width/2;\r\n        }\r\n    },\r\n    touchStart(event){\r\n        fsm.stickLengthen();\r\n        cc.log(\"touchStart\");\r\n    },\r\n    touchEnd(event){\r\n        fsm.heroTick();\r\n        cc.log(\"touchEnd\");\r\n    },\r\n    touchCancel(){\r\n        this.touchEnd();\r\n        cc.log(\"touchCancel\");\r\n    },\r\n    stickAndHeroDownAction(callFunc){\r\n        //stick down action;\r\n        var stickAction = cc.rotateBy(0.5, 90);\r\n        stickAction.easing(cc.easeIn(3));\r\n        this.stick.runAction(stickAction);\r\n        //hero down action;\r\n        var heroAction = cc.moveBy(0.5,cc.p(0,-300 - this.hero.height));\r\n        heroAction.easing(cc.easeIn(3));\r\n        var seq =cc.sequence(heroAction,callFunc);\r\n        this.hero.runAction(seq);\r\n    },\r\n    heroMove(target,data){\r\n        var time = data.length/this.heroMoveSpeed;\r\n        var heroMove = cc.moveBy(time,cc.p(data.length,0));\r\n        if(data.callFunc){\r\n            var se =cc.sequence(heroMove,data.callFunc);\r\n            this.hero.runAction(se);\r\n        }else{\r\n            this.hero.runAction(heroMove);\r\n        }\r\n    },\r\n    landCreateAndMove(callFunc) {\r\n        var winSize = cc.director.getWinSize();\r\n        //firstland;\r\n        var length = this.currentLandRange + this.secondLand.width;\r\n        this.runLength +=length;\r\n        var action = cc.moveBy(this.moveDuration,cc.p(-length,0));\r\n        this.node.runAction(action);\r\n        this.firstLand = this.secondLand;\r\n\r\n        this.createNewLand();\r\n\r\n        //landRange\r\n        var range = this.getLandRange();\r\n\r\n        //secondland;\r\n        this.secondLand.setPosition(this.runLength+winSize.width,0);\r\n        var l = winSize.width - range - this.heroWorldPosX - this.hero.width * this.hero.anchorX - this.stickWidth;\r\n        var secondAction = cc.moveBy(this.moveDuration,cc.p(-l,0));\r\n        var seq =cc.sequence(secondAction,callFunc);\r\n        this.secondLand.runAction(seq);\r\n    },\r\n    createStick(){\r\n        cc.log(\"sc\");\r\n        var stick = spriteCreator.createStick(this.stickWidth);\r\n        stick.parent = this.node;\r\n        return stick\r\n    },\r\n    createNewLand() {\r\n        this.secondLand = spriteCreator.createNewLand(this.getLandWidth());\r\n        this.secondLand.parent = this.node;\r\n    },\r\n    getScore(num){\r\n        if(num){\r\n            this.score += num;  \r\n        }else{\r\n            this.score++;\r\n        }\r\n        if(storageManager.getHighestScore()<this.score){\r\n            storageManager.setHighestScore(this.score);\r\n            this.changeHightestScoreLabel();\r\n        }\r\n        this.scoreLabel.string = \"得分:\"+this.score;\r\n    },\r\n    changeHightestScoreLabel(){\r\n        this.hightestScoreLabel.string = \"最高分:\" + storageManager.getHighestScore();\r\n    },\r\n    getLandRange(){\r\n        this.currentLandRange = this.landRange.x +(this.landRange.y - this.landRange.x)*Math.random();\r\n        var winSize = cc.director.getWinSize();\r\n        if(winSize.width < this.currentLandRange + this.heroWorldPosX + this.hero.width + this.secondLand.width){\r\n            this.currentLandRange = winSize.width - this.heroWorldPosX - this.hero.width - this.secondLand.width;\r\n        }\r\n        return this.currentLandRange;\r\n    },\r\n    getLandWidth(){\r\n        return this.landWidth.x + (this.landWidth.y - this.landWidth.x)* Math.random();\r\n    }\r\n});\r\nmodule.exports = fsm;"]}